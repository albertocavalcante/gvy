name: signature-help-basic
description: >
  Test textDocument/signatureHelp.
  Verifies that available signatures are returned for a method call.
workspace:
 fixture: empty-workspace
steps:
  - initialize: {}
  - initialized: {}
  - waitNotification:
      method: groovy/status
      checks:
        - jsonPath: $.status
          expect:
            type: EQUALS
            value: Ready
      timeoutMs: 60000

  - openDocument:
      path: src/SigHelpTest.groovy
      languageId: groovy
      version: 1
      text: |
        class SigHelpTest {
            void method() {
                println()
            }
        }
  
  - waitNotification:
      method: textDocument/publishDiagnostics
      timeoutMs: 10000

  # Trigger signature help inside parens of println()
  # Line 2: "        println()"
  # Position 16 is right after '('
  - request:
      method: textDocument/signatureHelp
      params:
        textDocument:
          uri: "{{workspace.uri}}src/SigHelpTest.groovy"
        position:
          line: 2
          character: 16
      saveAs: sigHelpResult

  # Verify we get at least one println signature
  # Script.println() has multiple overloads, so check signatures is not empty
  - assert:
      source: sigHelpResult
      checks:
        # Check that we got signatures (not empty)
        - jsonPath: $.signatures.length()
          expect:
            type: EQUALS
            value: 2
            message: "Expected 2 println() overloads from groovy.lang.Script"

        # Check that activeSignature is set
        - jsonPath: $.activeSignature
          expect:
            type: EQUALS
            value: 0

  - shutdown: {}
  - exit: {}
