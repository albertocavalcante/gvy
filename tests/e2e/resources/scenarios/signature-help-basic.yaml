name: signature-help-basic
description: >
  Test textDocument/signatureHelp.
  Verifies that available signatures are returned for a method call.
workspace:
  fixture: empty-workspace
steps:
  - initialize: {}
  - initialized: {}
  - waitNotification:
      method: groovy/status
      checks:
        - jsonPath: $.health
          expect:
            type: EQUALS
            value: ok
        - jsonPath: $.quiescent
          expect:
            type: EQUALS
            value: true
      timeoutMs: 60000

  - openDocument:
      path: src/SigHelpTest.groovy
      languageId: groovy
      version: 1
      text: |
        class SigHelpTest {
            void method() {
                println()
            }
        }
  
  - waitNotification:
      method: textDocument/publishDiagnostics
      timeoutMs: 10000

  # Trigger signature help inside parens of println()
  # Line 2: "        println()"
  # Index 16 is right after '('
  - request:
      method: textDocument/signatureHelp
      params:
        textDocument:
          uri: "{{workspace.uri}}src/SigHelpTest.groovy"
        position:
          line: 2
          character: 16
      saveAs: sigHelpResult

  # Verify signatures
  - assert:
      source: sigHelpResult
      checks:
        # Check that we got println overloads (Script + GDK + Classpath)
        # Should be 4 signatures total
        - jsonPath: $.signatures.length()
          expect:
            type: EQUALS
            value: 4
            message: "Expected 4 println() overloads (Script + GDK)"

        # Check that activeSignature is set
        - jsonPath: $.activeSignature
          expect:
            type: EQUALS
            value: 0
            
        # Check activeParameter is 0 (cursor at first param position)
        - jsonPath: $.activeParameter
          expect:
            type: EQUALS
            value: 0

        # TODO(#466): Add strict label assertions once we improve signature formatting
        #   Currently signatures use simplified format "println()" without modifiers.
        #   Ideal format: "public void println()" matching IDE conventions.

  - shutdown: {}
  - exit: {}
