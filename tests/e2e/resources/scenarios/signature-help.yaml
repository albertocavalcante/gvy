# FIXME: Flaky test due to timeout
name: signature-help
description: "Verify signature help functionality"
workspace:
  fixture: signature-help
steps:
  - initialize: {}
  - initialized: {}
  - waitNotification:
      method: groovy/status
      checks:
        - jsonPath: $.status
          expect:
            type: EQUALS
            value: Ready
      timeoutMs: 60000
  - openDocument:
      path: src/Main.groovy
      languageId: groovy
      version: 1
      text: |
        class Main {
            def myMethod(String arg1, int arg2) {}
            def run() {
                myMethod()
            }
        }
  - request:
      method: textDocument/signatureHelp
      params:
        textDocument:
          uri: "{{workspace.uri}}src/Main.groovy"
        position:
          line: 3
          character: 17
      saveAs: signatureHelp
  - assert:
      source: signatureHelp
      checks:
        # Format: "returnType methodName(params)"
        - jsonPath: $.signatures[0].label
          expect:
            type: EQUALS
            value: "Object myMethod(String arg1, int arg2)"
        - jsonPath: $.signatures[0].parameters[*].label.left
          expect:
            type: EQUALS
            value:
              - "String arg1"
              - "int arg2"
        - jsonPath: $.activeSignature
          expect:
            type: EQUALS
            value: 0
        - jsonPath: $.activeParameter
          expect:
            type: EQUALS
            value: 0

        # TODO(#466): Add documentation support for signatures
        #   - Needs GroovyDoc parser integration
        #   - See SIGNATURE.md for details

        # TODO(#466): Use offset-based RangeLabel for parameter highlighting
        #   - This allows editors to highlight exact parameter ranges in signature
        #   - See SIGNATURE.md for details

  - shutdown: {}
  - exit: {}
