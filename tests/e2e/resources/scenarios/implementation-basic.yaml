name: implementation-basic
description: >
  Test textDocument/implementation to navigate to implementations.
  Verifies that requesting implementation on an interface works.

workspace:
  fixture: empty-workspace
steps:
  - initialize: {}
  - initialized: {}
  # Wait for server to be ready
  - waitNotification:
      method: groovy/status
      checks:
        - jsonPath: $.status
          expect:
            type: EQUALS
            value: Ready
      timeoutMs: 60000

  - openDocument:
      path: src/ImplTest.groovy
      languageId: groovy
      version: 1
      text: |
        interface Shape {
            def area()
        }
        
        class Square implements Shape {
            def area() { return 100 }
        }
        
        Shape myShape = new Square()
  
  # Wait for diagnostics
  - waitNotification:
      method: textDocument/publishDiagnostics
      timeoutMs: 10000

  # Test 1: Find implementation of Interface
  # Trigger on 'Shape' in 'Shape myShape' (line 8, char 0-5)
  - request:
      method: textDocument/implementation
      params:
        textDocument:
          uri: "{{workspace.uri}}src/ImplTest.groovy"
        position:
          line: 8
          character: 2
      saveAs: implResult

  # Find implementation of Method
  # Trigger on 'area' in 'interface Shape { def area() }' (line 1, char 16)
  - request:
      method: textDocument/implementation
      params:
        textDocument:
          uri: "{{workspace.uri}}src/ImplTest.groovy"
        position:
          line: 1
          character: 16
      saveAs: methodImplResult

  # Verify interface implementation found (Square class)
  - assert:
      source: implResult
      checks:
        - jsonPath: $
          expect:
            type: CONTAINS
            value: 
              uri: "{{workspace.uri}}src/ImplTest.groovy"
              range:
                start:
                  line: 4
                  character: 0
                end:
                  line: 6
                  character: 1
            message: "Should find Square class implementation"

  # Verify method implementation found (Square.area)
  - assert:
      source: methodImplResult
      checks:
        - jsonPath: $
          expect:
            type: CONTAINS
            value:
                uri: "{{workspace.uri}}src/ImplTest.groovy"
                range:
                    start:
                        line: 5
                        character: 4
                    end:
                        line: 5
                        character: 29
            message: "Should find Square.area implementation"

  - shutdown: {}
  - exit: {}
