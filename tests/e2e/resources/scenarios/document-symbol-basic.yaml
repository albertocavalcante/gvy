name: document-symbol-basic
description: Document symbols should include class and method entries.
workspace:
  fixture: empty-workspace
steps:
  - initialize: {}
  - initialized: {}
  - waitNotification:
      method: groovy/status
      checks:
        - jsonPath: $.health
          expect:
            type: EQUALS
            value: ok
        - jsonPath: $.quiescent
          expect:
            type: EQUALS
            value: true
      timeoutMs: 180000
  - openDocument:
      path: src/Symbols.groovy
      languageId: groovy
      version: 1
      text: |
        package com.example

        class Widget {
            String name

            Widget(String name) {
                this.name = name
            }

            int compute(int value) {
                return value + name.length()
            }
        }
  - request:
      method: textDocument/documentSymbol
      params:
        textDocument:
          uri: "{{workspace.uri}}src/Symbols.groovy"
      saveAs: documentSymbols
  - assert:
      source: documentSymbols
      checks:
        - jsonPath: $.length()
          expect:
            type: EQUALS
            value: 7
        - jsonPath: "$.[?(@.right.name == 'Widget' && @.right.kind == 'Class')]"
          expect:
            type: NOT_EMPTY
        - jsonPath: "$.[?(@.right.name == 'Widget' && @.right.kind == 'Constructor')]"
          expect:
            type: NOT_EMPTY
        - jsonPath: "$.[?(@.right.name == 'compute' && @.right.kind == 'Method')]"
          expect:
            type: NOT_EMPTY
        - jsonPath: "$.[?(@.right.name == 'name' && @.right.kind == 'Property')]"
          expect:
            type: NOT_EMPTY
        - jsonPath: "$.[?(@.right.name == 'name' && @.right.kind == 'Field')]"
          expect:
            type: NOT_EMPTY
        - jsonPath: "$.[?(@.right.name == 'name' && @.right.kind == 'Variable')]"
          expect:
            type: NOT_EMPTY
        - jsonPath: "$.[?(@.right.name == 'value' && @.right.kind == 'Variable')]"
          expect:
            type: NOT_EMPTY
  - shutdown: {}
  - exit: {}
