# .envrc
# Load SDKMAN environment if available
# Locate SDKMAN (Default or Homebrew)
if [ -z "$SDKMAN_DIR" ]; then
    if [ -d "$HOME/.sdkman" ]; then
        SDKMAN_DIR="$HOME/.sdkman"
    elif command -v brew >/dev/null && [ -d "$(brew --prefix sdkman-cli 2>/dev/null)/libexec" ]; then
        SDKMAN_DIR="$(brew --prefix sdkman-cli)/libexec"
    fi
fi

# Load SDKMAN environment if available
if [ -s ".sdkmanrc" ] && [ -n "$SDKMAN_DIR" ]; then
    JAVA_VERSION=$(grep "^java=" .sdkmanrc | cut -d= -f2)
    if [ -n "$JAVA_VERSION" ]; then
        candidate_home="$SDKMAN_DIR/candidates/java/$JAVA_VERSION"
        if [ -d "$candidate_home" ]; then
           export JAVA_HOME="$candidate_home"
           # Use direnv's PATH_add helper
           PATH_add "$JAVA_HOME/bin"
           echo "‚òïÔ∏è Activated SDKMAN Java $JAVA_VERSION from $candidate_home"
        else
           echo "‚ö†Ô∏è Java $JAVA_VERSION not found at $candidate_home. Please run './tools/macos/setup.sh'."
        fi
    fi
fi

# Local High-Performance Gradle Override
# Overrides repo-level safe defaults (4GB/G1GC) with machine-specific power settings (8GB/ZGC)
export ORG_GRADLE_PROJECT_org_gradle_jvmargs="-Xms2g -Xmx8g -XX:+UseZGC -XX:+ZGenerational -XX:MaxMetaspaceSize=1g -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8"
echo "üêò Gradle optimized for Local Dev (8GB Heap + ZGC)"

# Add agent scripts to PATH
PATH_add ".agent/scripts"
echo "ü§ñ Agent scripts added to PATH (invoke 'pr' command)"
